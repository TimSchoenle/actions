name: Test Bot Identity
on: workflow_dispatch

permissions:
  contents: write

jobs:
  test-identity:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Generate Bot Token
        id: generate_token
        uses: actions/create-github-app-token@29824e69f54612133e76f7eaac726eef6c875baf # v2.2.1
        with:
          app-id: ${{ secrets.ACTIONS_MAINTENANCE_APP_ID }}
          private-key: ${{ secrets.ACTIONS_MAINTENANCE_PRIVATE_KEY }}
          permission-contents: write
          permission-pull-requests: write

      - name: Get Bot User Info
        id: get-bot-info
        uses: ./actions/common/get-app-git-identity
        with:
          app-slug: ${{ steps.generate_token.outputs.app-slug }}
          token: ${{ steps.generate_token.outputs.token }}

      - name: Generate Random File
        run: |
          mkdir -p test-artifacts
          echo "Random content: $(date +%s)" > test-artifacts/random-${{ github.run_id }}.txt

      - name: Commit and Push
        uses: stefanzweifel/git-auto-commit-action@04702edda442b2e678b25b537cec683a1493fcb9 # v7
        with:
          commit_options: --signoff
          commit_message: 'test: verify bot identity [skip ci]'
          commit_author: '${{ steps.get-bot-info.outputs.bot-name }} <${{ steps.get-bot-info.outputs.bot-email }}>'
          commit_user_name: ${{ steps.get-bot-info.outputs.bot-name }}
          commit_user_email: ${{ steps.get-bot-info.outputs.bot-email }}
